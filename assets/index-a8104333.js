import{p as Q,S as Z,E as z,x as G,F as J,G as M,H as W,b as D,y as u,h as p,e as N,n as C,j as K}from"./vendor-c7dea3c8.js";import{b as g,u as X,g as Y,n as tt,e as T,_ as st,a as A,c as et,d as at,f as x,Z as it,h as rt,T as H,s as ct}from"./index-fc6f5fe7.js";var nt=Object.defineProperty,ot=Object.getOwnPropertyDescriptor,ht=(t,s,e,i)=>{for(var a=i>1?void 0:i?ot(s,e):s,r=t.length-1,c;r>=0;r--)(c=t[r])&&(a=(i?c(s,e,a):c(a))||a);return i&&a&&nt(s,e,a),a};class U extends Z{constructor(s){super(),this.key="",this.key=s}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}ht([Q({value:[]})],U.prototype,"queue",2);const lt=7200*1e3;class ut{constructor(s){this.provider=X().bridgeStore.bridge.provider,this.store=new U(`evm.txs.${s||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(s){if(!s.chainId){const{network:e}=this.provider;s.chainId=e.chainId,s.scan=e.scan}s.pending=!0,this.queue.unshift(s),this.store.save(),this.provider.nonce=+s.nonce+1}delDelay(s,e=0){setTimeout(()=>this.del(s),e)}del(s){var i,a;const e=(a=(i=s.hash)!=null?i:s.ts)!=null?a:s;this.queue.some((r,c)=>{if([r.hash,r.ts,r].includes(e)){c===0&&(this.provider.nonce=0);const n=this.queue.splice(c,1);return this.store.save(),n}})}async check(s){this.queue.forEach(async(e,i)=>{if(s&&i===0){const a=await Y(this.provider.account),r=+e.nonce;this.provider.nonce=r>a?r+1:a}if(e.done||new Date().getTime()-e.ts>=lt)return this.del(e);if(!e.err&&!(!s&&e.pending)){e.pending=!0;try{const a=await this.provider.waitForTransaction(e.hash),{status:r}=a;e.status=r,r===1?(e.done=!0,this.del(e)):e.err=!0}catch(a){e.err=a}e.pending=!1}}),this.store.save()}}const L={},S=(t=g.bridge.account)=>L[t]||(L[t]=new ut(t)),dt=async t=>t?typeof t=="object"?t:await st(Object.assign({"./abi/Locker.codes.json":()=>A(()=>import("./Locker.codes-d3f42ed5.js"),[]),"./abi/Resolver.codes.json":()=>A(()=>import("./Resolver.codes-ee4f74d3.js"),[])}),`./abi/${t}.codes.json`):{};class ft{constructor(s,{errorCodes:e="",seq:i=void 0,delay:a=0,allowAlmostSuccess:r=!1,onSent:c=()=>{},onSuccess:n=()=>{},onError:o=()=>{}}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=r,this.txPromise=s,this.err=void 0,this.hash="",this.errorCodes=e,this.seq=i,this.delay=a,this.onSent=c,this.onSuccess=n,this.onError=o}get success(){return this.status===1}get processing(){return this.status===2}get almostSuccess(){return this.status===4}get ignored(){return this.status===3}async wait(s=!1){return(async()=>{let e=!1;const i=await dt(this.errorCodes);try{const a=await this.txPromise;this.onSent(a);const{hash:r,nonce:c}=a;this.seq.nonce=c,this.seq&&(delete this.seq.overrides,S().add(Object.assign(this.seq,{hash:r}))),this.hash=r,this.status=2;const n=async()=>{const{status:o,events:l}=await a.wait(1);if(o!==1)throw this.seq&&(this.seq.err=!0),new Error("Failed");l.some(({event:m,args:b}={})=>{if(m==="Failure"){let{info:v,detail:y,error:_}=b;const j=_.toString(),I=i[_],V={code:j,message:I,error:_,info:v==null?void 0:v.toString(),detail:y==null?void 0:y.toString()};this.seq&&(this.seq.err=!0);const E=new Error(I);throw Object.assign(E,{code:j,raw:V}),this.allowAlmostSuccess&&(this.status=4),E}}),this.status=1,this.seq&&(this.seq.done=!0),this.delay?S().delDelay(r,this.delay):S().del(r)};s?(e=!0,n()):await n(),this.onSuccess(a)}catch(a){throw await tt(a),a.code===4001?this.status=3:this.status!==4&&(this.status=0),this.err=a,this.onError(a),a}finally{this.pending=!1;const a=this.status===1;T.emit("tx-status",this.hash),a&&T.emit("tx-success",this.hash),e=a}return e})()}}const P={A:2,B:4,C:6},h=t=>[t,P[t]],gt={"0x1":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":h("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":h("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":h("C")},"0xaa36a7":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":h("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":h("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":h("C")},"0x5":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":h("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":h("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":h("C")}},B=[64,130],q=async()=>gt[await et()],pt=async()=>Object.fromEntries(Object.entries(await q()).map(t=>[t[1][0],t[0]])),f=async()=>at("Locker",{account:await x()}),O=t=>t.replace(/^0x/,""),$=t=>B[t.length<B[1]?0:1],wt=t=>(t=O(t),`0x${t.slice(0,$(t))}`),R=t=>{t=O(t);const s=$(t);return t.slice(s,s+1).toUpperCase()},xt=t=>(t=O(t),parseInt(t.slice($(t)+1,t.length)||"0",16)),Ot=t=>{var s,e;return(e=P[(s=R(t))!=null?s:"C"])!=null?e:P.C},$t=async t=>{t||(t=await x());const s=z(G("C"));let e="";return e=J(BigInt(t)^BigInt(s)),[e.replace("0x",""),"c","0"].join("")},jt=async t=>await(await f()).nameExists(t),It=async(t,s=!1)=>(t||(t=await x()),await(await f())[s?"getUserPassesInfo":"getUserPassList"](t)),mt=async t=>{let s="";if(!t||t===it)return s;const e=await f();try{s=await e.getNameByHash(M(t))}catch(i){}return s},Et=async(t,s)=>{var r;const e=await f(),i=await q();let a={id:t,cate:"C",len:6,name:""};try{const[c,n,o]=await e.getUserPassInfo(t),l=(r=i[n])!=null?r:Object.values(a);a={id:c,cate:l[0],hash:o,len:l[1],name:await mt(o)}}catch(c){}return a},Tt=async(t,s="")=>{let{id:e,code:i,cate:a}=t;const r=!!e;if(!e){i=wt(t);const b=await pt();console.log(14),a=b[R(t)],e=xt(t)}const c=await f(),n=r?"lockName":"lockPass",o={},l=r?[+e,s]:[i,s,a,+e];await rt(o,c,n,l),console.log(2);const m=c[n](...l);return new ft(m,{errorCodes:"Locker",allowAlmostSuccess:!0,seq:{type:r?"LockName":"lockPass",title:r?"Lock Name":"Lock Pass",ts:new Date().getTime(),overrides:o}})},At=async t=>{t||(t=await x());const e=await(await f()).getUserInvitedNumber(t);return W(e[1],0)},bt="";var vt=Object.defineProperty,yt=Object.getOwnPropertyDescriptor,F=(t,s,e,i)=>{for(var a=i>1?void 0:i?yt(s,e):s,r=t.length-1,c;r>=0;r--)(c=t[r])&&(a=(i?c(s,e,a):c(a))||a);return i&&a&&vt(s,e,a),a};let k=class extends H(bt){constructor(){super(...arguments),this.bindBridge=new D(this,g)}get bridge(){return g.bridge}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return u`<dui-link class="uri mt-4" href="${this.txScanUri}" target="_blank" rel="noopener">View Transaction: ${ct(this.tx.hash)}</dui-link>`}};F([p({type:Object})],k.prototype,"tx",2);k=F([N("tx-view")],k);const _t=`.tx-state{display:flex;flex-direction:column;align-items:center;flex-grow:1}.tx-state-icon.success{color:green}.tx-state-icon.failed{color:red}.tx-state-icon.warn{color:orange}.tx-state-msg{word-break:break-word;white-space:normal}
`;var Ct=Object.defineProperty,St=Object.getOwnPropertyDescriptor,w=(t,s,e,i)=>{for(var a=i>1?void 0:i?St(s,e):s,r=t.length-1,c;r>=0;r--)(c=t[r])&&(a=(i?c(s,e,a):c(a))||a);return i&&a&&Ct(s,e,a),a};let d=class extends H(_t){constructor(){super(),this.bindBridge=new D(this,g),this.txType=!1,this.onlyAwaitHash=!1,this.opts={}}get bridge(){return g.bridge}get icons(){var a;const[t='<i class="mdi mdi-check-all"></i>',s='<i class="mdi mdi-check"></i>',e='<i class="mdi mdi-close"></i>',i='<i class="mdi mdi-loading"></i>']=(a=this.opts.icons)!=null?a:[];return{success:t,failed:e,wait:i,almostSuccess:s}}get hashOk(){return this.onlyAwaitHash&&this.tx.hash}get state(){var a,r,c;let[t,s,e]=["","",""];const{state:i}=this.opts;switch(this.tx.status){case-1:[t,s,e]=[this.icons.wait,(i==null?void 0:i.wait)||"Waiting for confirmation...","wait"];break;case 0:[t,s,e]=[this.icons.failed,(r=(a=this.tx.err)==null?void 0:a.message)!=null?r:"Something went wrong","failed"];break;case 1:[t,s,e]=[this.icons.success,(i==null?void 0:i.success)||"Success","success"];break;case 2:[t,s]=[this.icons.wait,"Confirm the transaction."];break;case 4:[t,s,e]=[this.icons.almostSuccess,((c=this.tx.err)==null?void 0:c.message)||"Almost Success","warn"];break}return this.hashOk&&([t,s,e]=[this.icons.success,(i==null?void 0:i.success)||"Success","success"]),{icon:t,txt:s,css:e}}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return u`<div class="tx-state m-4"><div class="tx-state-icon my-3 text-3xl mx-auto ${this.state.css}">${C(this.tx.pending&&!this.hashOk,()=>u`<slot name="pending"><i class="mdi mdi-loading"></i></slot>`,()=>u`<span>${K(this.state.icon)}</span>`)}</div><div class="tx-state-msg my-4"><slot>${this.state.txt}</slot></div><div class="flex gap-4">${C(this.tx.hash,()=>u`${C(this.tx.success||this.tx.almostSuccess,()=>u`<slot name="view"><tx-view .tx="${this.tx}"></tx-view></slot>`,()=>u`<tx-view .tx="${this.tx}"></tx-view>`)}`)}</div></div>`}};w([p({type:Object})],d.prototype,"tx",2);w([p({type:Boolean})],d.prototype,"txType",2);w([p({type:Boolean})],d.prototype,"onlyAwaitHash",2);w([p({type:Object})],d.prototype,"opts",2);d=w([N("tx-state")],d);export{B as L,$t as a,Et as b,jt as c,At as d,f as e,It as f,Ot as g,q as h,mt as i,Tt as l,ft as t};
