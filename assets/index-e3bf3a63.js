import{T as x,b as l,d as j,f as S,h as T,i as N}from"./index-99a6c21b.js";import{b as w,y as o,f as c,h as v,e as $,n as d,d as C,E as B,k as U}from"./vendor-cf07880b.js";import{a as Y,d as z,t as F,e as R,f as A,h as E,i as M}from"./index-45b1e1b8.js";const V="";var q=Object.defineProperty,G=Object.getOwnPropertyDescriptor,k=(t,s,n,i)=>{for(var e=i>1?void 0:i?G(s,n):s,a=t.length-1,r;a>=0;a--)(r=t[a])&&(e=(i?r(s,n,e):r(e))||e);return i&&e&&q(s,n,e),e};let g=class extends x(V){constructor(){super(...arguments),this.bindBridge=new w(this,l),this.name="",this.limit="0",this.inviteCode="",this.genInviteCode=async()=>{try{let t=await Y();t&&(this.inviteCode=t)}catch(t){}}}get bridge(){return l.bridge}get inviteLink(){return`https://lockpass.doid.tech/?ic=${this.inviteCode}`}async connectedCallback(){super.connectedCallback(),this.limit=await z()}get shareText(){return`DOID lock name event is live. Mint your lock pass NFT for free and reserve your desired name now. Get invitation here: ${this.inviteLink}`}render(){return o`<p class="text-sm text-gray-500">You have <b>${this.limit}</b> invitations in total. Copy the invitation code or share the link.</p><div class="py-2">${this.inviteCode?o`<textarea class="block w-full h-24 my-3 border border-solid border-gray-200 py-2 px-2 text-gray-400" readonly="readonly">
${this.shareText}</textarea><dui-copy value="${this.shareText}" sm class="outlined"><span slot="copied">Copy<i class="ml-1 mdi mdi-check text-green-600"></i></span><span slot="copy">Copy<i class="ml-1 mdi mdi-content-copy"></i></span></dui-copy>`:+this.limit>0?o`<dui-button sm @click="${this.genInviteCode}">Share</dui-button>`:o``}</div>`}};k([v()],g.prototype,"name",2);k([c()],g.prototype,"limit",2);k([c()],g.prototype,"inviteCode",2);g=k([$("pass-share")],g);var H=Object.defineProperty,J=Object.getOwnPropertyDescriptor,u=(t,s,n,i)=>{for(var e=i>1?void 0:i?J(s,n):s,a=t.length-1,r;a>=0;a--)(r=t[a])&&(e=(i?r(s,n,e):r(e))||e);return i&&e&&H(s,n,e),e};const K=async t=>{const s=await j("Locker",{account:await S()}),[n,i,e]=["claimDoid",{},[+t]];await T(i,s,n,e);const a=s[n](...e);return new F(a,{errorCodes:"Locker",seq:{type:"claim-name",title:"Claim Name",ts:new Date().getTime(),overrides:i}})};let p=class extends x(""){constructor(){super(...arguments),this.bindBridge=new w(this,l),this.sm=!1,this.tx=null,this.success=!1,this.dialog=!1,this.claim=async()=>{try{this.tx=await K(+this.passId),this.success=await this.tx.wait()}catch(t){if(t.code===4001)return this.close()}}}get name(){var t;return(t=this.nameInfo)==null?void 0:t.name}get passId(){var t;return((t=this.nameInfo)==null?void 0:t.id)||0}get txPending(){var t;return this.tx&&!((t=this.tx)!=null&&t.ignored)}close(t=!1){this.dialog=!1,this.tx=void 0,t&&this.emit("success"),this.emit("show",!1)}open(){this.dialog=!0,this.emit("show",!0)}render(){return o`<dui-button ?disabled="${this.dialog}" ?pending="${this.dialog}" class="success" @click="${this.open}" ?sm="${this.sm}"><slot>Claim</slot></dui-button>${d(this.dialog,()=>{var t;return o`<dui-dialog @close="${()=>this.close()}"><div slot="header">Claim DOID name</div><div class="min-h-10">${d(!((t=this.tx)!=null&&t.success),()=>o`<div class="text-center">You are claiming for:<p class="text-black my-4 text-lg"><b class="text-blue-600">${this.name}</b>.doid</p><p>${o`(Note: This pass <b class="text-base text-orange-500">#${this.passId}</b> will be burned after claiming.)`}</p></div>`)} ${d(this.txPending,()=>o`<tx-state .tx="${this.tx}" .opts="${{state:{success:`Success. You are the registrant of ${this.name} now`}}}"><dui-button slot="view" @click="${()=>this.close(!0)}">Close</dui-button></tx-state>`,()=>o`<p class="mt-8 text-center"><dui-button class="success" @click="${this.claim}">Continue</dui-button></p>`)}</div></dui-dialog>`})}`}};u([v({type:Object})],p.prototype,"nameInfo",2);u([v({type:Boolean})],p.prototype,"sm",2);u([c()],p.prototype,"tx",2);u([c()],p.prototype,"success",2);u([c()],p.prototype,"dialog",2);p=u([$("doid-claim-name")],p);const Q=`:host{--posterSize: 90px}.pass{position:relative;display:flex;height:100%;gap:1rem;border-width:1px;--tw-border-opacity: 1;border-color:rgba(209,213,219,var(--tw-border-opacity));padding:1rem;min-height:8.5rem}.pass .poster{margin-bottom:1rem;width:var(--posterSize);height:var(--posterSize)}.pass .poster:not(.minted){--tw-bg-opacity: 1;background-color:rgba(243,244,246,var(--tw-bg-opacity))}.pass .name.locked{font-size:1rem;line-height:1.5rem}.pass .status.locked{--tw-text-opacity: 1;color:rgba(22,163,74,var(--tw-text-opacity))}.pass .status.unlock{--tw-text-opacity: 1;color:rgba(107,114,128,var(--tw-text-opacity))}.pass .status.minted{--tw-text-opacity: 1;color:rgba(96,165,250,var(--tw-text-opacity))}
`;var W=Object.defineProperty,X=Object.getOwnPropertyDescriptor,b=(t,s,n,i)=>{for(var e=i>1?void 0:i?X(s,n):s,a=t.length-1,r;a>=0;a--)(r=t[a])&&(e=(i?r(s,n,e):r(e))||e);return i&&e&&W(s,n,e),e};let h=class extends x(Q){constructor(){super(...arguments),this.bindBridge=new w(this,l),this.item={},this.tx=null,this.success=!1,this.dialog=!1}get bridge(){return l.bridge}get scan(){return this.bridge.network.current.scan}get tokenLink(){return`${this.scan}/token/${N("Locker")}?a=${this.item.id}`}onSuccess(){this.emit("change")}render(){let t="",s="";return this.item.name?(t="locked",s="Locked"):(t="unlock",s="No name locked yet"),o`<div class="pass ${C({})}"><div class="poster ${C({minted:this.item.meta.image,"opacity-40":this.dialog,grayscale:this.dialog})}"><img src="${this.item.meta.image}" class="object-contain"></div><div class="flex flex-col grow text-xs ${C({"opacity-40":this.dialog,grayscale:this.dialog})}"><div><span class="text-base">#${this.item.id}</span><p class="mb-4"><dui-link class="text-black uri" href="${this.tokenLink}" target="_blank">View on etherscan</dui-link></p></div><div><div class="status ${t}">${s}</div>${d(this.item.name,()=>o`<div class="name ${t}"><b class="text-blue-600">${this.item.name}</b>.doid</div>`)}<div class="actions mt-2">${d(this.item.name,()=>o`<doid-claim-name @success="${this.onSuccess}" sm .nameInfo="${this.item}"></doid-claim-name>`,()=>o`<dui-button href="/?pid=${this.item.id}" sm>Lock a name</dui-button>`)}</div></div></div></div>`}};b([v({type:Object})],h.prototype,"item",2);b([c()],h.prototype,"tx",2);b([c()],h.prototype,"success",2);b([c()],h.prototype,"dialog",2);h=b([$("pass-item")],h);const Z=`.passes{min-height:300px;height:100%;--tw-bg-opacity: 1;background-color:rgba(255,255,255,var(--tw-bg-opacity))}
`;var tt=Object.defineProperty,et=Object.getOwnPropertyDescriptor,y=(t,s,n,i)=>{for(var e=i>1?void 0:i?et(s,n):s,a=t.length-1,r;a>=0;a--)(r=t[a])&&(e=(i?r(s,n,e):r(e))||e);return i&&e&&tt(s,n,e),e};let m=class extends x(Z){constructor(){super(...arguments),this.bindBridge=new w(this,l),this.name="",this.passes=[],this.pending=!1,this.ts=0}get bridge(){return l.bridge}async getUserPassList(){if(l.notReady)return;this.pending=!0;const{account:t}=l.bridge,s=await R();try{const n=await A(t,!0),i=await E();let e=await Promise.all(n.map(async a=>{var I;const[r,L,P]=a,_=B(r,0),O=(I=i[L])!=null?I:[],f={id:_,cate:O[0],hash:P,meta:{}},D=await Promise.all([M(P),s.tokenURI(_)]);f.name=D[0],f.len=`${O[1]}`;try{f.meta=await(await fetch(D[1])).json()}catch(st){}return f}));this.passes=e.sort((a,r)=>a.id-r.id).sort((a,r)=>a.name?r.name?a.id-r.id:-1:1)}catch(n){console.log(n,"get passess failed"),this.passes=[]}finally{this.ts++,this.pending=!1}}get empty(){return this.ts&&!this.passes.length}connectedCallback(){super.connectedCallback(),this.getUserPassList()}render(){return o`<div class="passes py-4"><div class="lg_w-3/5 my-8 mx-3 lg_mx-auto"><section><p class="text-base mb-2">Note</p><ul class="note list-disc mx-4"><li>You can only mint one Lock Pass for one wallet address.</li><li>Once you successfully locked your name. Your name will be reserved for 7 days after the official launch(22nd Dec,2022). Those locked but unminted names will be released to the public pool afterwards.</li></ul><dui-link href="${"https://twitter.com/DoidFoundation"}" target="_blank" rel="noopener" class="inline-flex my-1 text-base">Follow DOID Twitter and stay connected</dui-link></section>${d(l.noAccount,()=>o`<div class="my-8 text-center"><connect-wallet-btn></connect-wallet-btn></div>`,()=>o`<section class="mt-6"><h2 class="my-4 text-xl">My Lock Pass</h2><div class="py-4">${d(this.empty,()=>o`No passes yet.`,()=>o`${d(this.pending,()=>o`<i class="mdi mdi-loading mr-1"></i>Loading...`,()=>o`<div class="pass-list grid md_grid-cols-2 gap-4">${U(this.passes,t=>o`<pass-item @change="${this.getUserPassList}" key="${t.id}" .item="${t}"></pass-item>`)}</div>`)}`)}</div></section><section class="mt-6"><h2 class="text-xl mb-2">Share Lock Pass Invitations</h2>${this.passes.length?o`<pass-share></pass-share>`:o``}</section>`)}</div></div>`}};y([v()],m.prototype,"name",2);y([c()],m.prototype,"passes",2);y([c()],m.prototype,"pending",2);y([c()],m.prototype,"ts",2);m=y([$("view-passes")],m);export{m as ViewPasses};
