System.register(["./vendor-legacy.67b1e80d.js","./index-legacy.81f05e42.js"],(function(t,e){"use strict";var s,i,a,c,r,n,o,h,d,l,u,f,g,w,x,p,b,y,m,v,k,S,j,q,O,$,C;return{setters:[t=>{s=t.p,i=t.S,a=t.E,c=t.x,r=t.F,n=t.G,o=t.H,h=t.b,d=t.y,l=t.h,u=t.e,f=t.n,g=t.j},t=>{w=t.b,x=t.u,p=t.g,b=t.n,y=t.e,m=t._,v=t.a,k=t.c,S=t.d,j=t.f,q=t.Z,O=t.h,$=t.T,C=t.s}],execute:function(){var P=Object.defineProperty,A=Object.getOwnPropertyDescriptor;class B extends i{constructor(t){super(),this.key="",this.key=t}save(){this.queue=[...this.queue],localStorage.setItem(this.key,JSON.stringify(this.queue))}}((t,e,s,i)=>{for(var a,c=i>1?void 0:i?A(e,s):e,r=t.length-1;r>=0;r--)(a=t[r])&&(c=(i?a(e,s,c):a(c))||c);i&&c&&P(e,s,c)})([s({value:[]})],B.prototype,"queue",2);class I{constructor(t){this.provider=x().bridgeStore.bridge.provider,this.store=new B(`evm.txs.${t||this.provider.account}`),this.checking=new Set,this.check(!0)}get queue(){return this.store.queue}async add(t){if(!t.chainId){const{network:e}=this.provider;t.chainId=e.chainId,t.scan=e.scan}t.pending=!0,this.queue.unshift(t),this.store.save(),this.provider.nonce=+t.nonce+1}delDelay(t,e=0){setTimeout((()=>this.del(t)),e)}del(t){const e=t.hash??t.ts??t;this.queue.some(((t,s)=>{if([t.hash,t.ts,t].includes(e)){0===s&&(this.provider.nonce=0);const t=this.queue.splice(s,1);return this.store.save(),t}}))}async check(t){this.queue.forEach((async(e,s)=>{if(t&&0===s){const t=await p(this.provider.account),s=+e.nonce;this.provider.nonce=s>t?s+1:t}if(e.done||(new Date).getTime()-e.ts>=72e5)return this.del(e);if(!e.err&&(t||!e.pending)){e.pending=!0;try{const t=await this.provider.waitForTransaction(e.hash),{status:s}=t;e.status=s,1===s?(e.done=!0,this.del(e)):e.err=!0}catch(i){e.err=i}e.pending=!1}})),this.store.save()}}const E={},L=(t=w.bridge.account)=>E[t]||(E[t]=new I(t));class T{constructor(t,{errorCodes:e="",seq:s,delay:i=0,allowAlmostSuccess:a=!1,onSent:c=(()=>{}),onSuccess:r=(()=>{}),onError:n=(()=>{})}={}){this.pending=!0,this.status=-1,this.allowAlmostSuccess=a,this.txPromise=t,this.err=void 0,this.hash="",this.errorCodes=e,this.seq=s,this.delay=i,this.onSent=c,this.onSuccess=r,this.onError=n}get success(){return 1===this.status}get processing(){return 2===this.status}get almostSuccess(){return 4===this.status}get ignored(){return 3===this.status}async wait(t=!1){return(async()=>{let s=!1;const i=await(async t=>t?"object"==typeof t?t:await m(Object.assign({"./abi/Locker.codes.json":()=>v((()=>e.import("./Locker.codes-legacy.d5ca7e1e.js")),void 0),"./abi/Resolver.codes.json":()=>v((()=>e.import("./Resolver.codes-legacy.77c566ca.js")),void 0)}),`./abi/${t}.codes.json`):{})(this.errorCodes);try{const e=await this.txPromise;this.onSent(e);const{hash:a,nonce:c}=e;this.seq.nonce=c,this.seq&&(delete this.seq.overrides,L().add(Object.assign(this.seq,{hash:a}))),this.hash=a,this.status=2;const r=async()=>{const{status:t,events:s}=await e.wait(1);if(1!==t)throw this.seq&&(this.seq.err=!0),new Error("Failed");s.some((({event:t,args:e}={})=>{if("Failure"===t){let{info:t,detail:s,error:a}=e;const c=a.toString(),r=i[a],n={code:c,message:r,error:a,info:t?.toString(),detail:s?.toString()};this.seq&&(this.seq.err=!0);const o=new Error(r);throw Object.assign(o,{code:c,raw:n}),this.allowAlmostSuccess&&(this.status=4),o}})),this.status=1,this.seq&&(this.seq.done=!0),this.delay?L().delDelay(a,this.delay):L().del(a)};t?(s=!0,r()):await r(),this.onSuccess(e)}catch(a){throw await b(a),4001===a.code?this.status=3:4!==this.status&&(this.status=0),this.err=a,this.onError(a),a}finally{this.pending=!1;const t=1===this.status;y.emit("tx-status",this.hash),t&&y.emit("tx-success",this.hash),s=t}return s})()}}t("t",T);const U={A:2,B:4,C:6},D=t=>[t,U[t]],N={"0x1":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":D("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":D("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":D("C")},"0xaa36a7":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":D("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":D("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":D("C")},"0x5":{"0x03783fac2efed8fbc9ad443e592ee30e61d65f471140c10ca155e937b435b760":D("A"),"0x1f675bff07515f5df96737194ea945c36c41e7b4fcef307b7cd4d0e602a69111":D("B"),"0x017e667f4b8c174291d1543c466717566e206df1bfd6f30271055ddafdb18f72":D("C")}},H=t("L",[64,130]),F=t("h",(async()=>N[await k()])),R=t("e",(async()=>S("Locker",{account:await j()}))),_=t=>t.replace(/^0x/,""),G=t=>H[t.length<H[1]?0:1],J=t=>{t=_(t);const e=G(t);return t.slice(e,e+1).toUpperCase()},V=(t("g",(t=>U[J(t)??"C"]??U.C)),t("a",(async t=>{t||(t=await j());const e=a(c("C"));let s="";return s=r(BigInt(t)^BigInt(e)),[s.replace("0x",""),"c","0"].join("")})),t("c",(async t=>{const e=await R();return await e.nameExists(t)})),t("f",(async(t,e=!1)=>{t||(t=await j());const s=await R();return await s[e?"getUserPassesInfo":"getUserPassList"](t)})),t("i",(async t=>{let e="";if(!t||t===q)return e;const s=await R();try{e=await s.getNameByHash(n(t))}catch(l){}return e})));t("b",(async(t,e)=>{const s=await R(),i=await F();let a={id:t,cate:"C",len:6,name:""};try{const[e,c,r]=await s.getUserPassInfo(t),n=i[c]??Object.values(a);a={id:e,cate:n[0],hash:r,len:n[1],name:await V(r)}}catch(l){}return a})),t("l",(async(t,e="")=>{let{id:s,code:i,cate:a}=t;const c=!!s;s||(i=(t=>`0x${(t=_(t)).slice(0,G(t))}`)(t),a=(await(async()=>Object.fromEntries(Object.entries(await F()).map((t=>[t[1][0],t[0]]))))())[J(t)],s=(t=>(t=_(t),parseInt(t.slice(G(t)+1,t.length)||"0",16)))(t));const r=await R(),n=c?"lockName":"lockPass",o={},h=c?[+s,e]:[i,e,a,+s];await O(o,r,n,h);const d=r[n](...h);return new T(d,{errorCodes:"Locker",allowAlmostSuccess:!0,seq:{type:c?"LockName":"lockPass",title:c?"Lock Name":"Lock Pass",ts:(new Date).getTime(),overrides:o}})})),t("d",(async t=>{t||(t=await j());const e=await R(),s=await e.getUserInvitedNumber(t);return o(s[1],0)}));var W=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,z=(t,e,s,i)=>{for(var a,c=i>1?void 0:i?Z(e,s):e,r=t.length-1;r>=0;r--)(a=t[r])&&(c=(i?a(e,s,c):a(c))||c);return i&&c&&W(e,s,c),c};let K=class extends($("")){constructor(){super(...arguments),this.bindBridge=new h(this,w)}get bridge(){return w.bridge}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return d`<dui-link class="uri mt-4" href="${this.txScanUri}" target="_blank" rel="noopener">View Transaction: ${C(this.tx.hash)}</dui-link>`}};z([l({type:Object})],K.prototype,"tx",2),K=z([u("tx-view")],K);var M=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,X=(t,e,s,i)=>{for(var a,c=i>1?void 0:i?Q(e,s):e,r=t.length-1;r>=0;r--)(a=t[r])&&(c=(i?a(e,s,c):a(c))||c);return i&&c&&M(e,s,c),c};let Y=class extends($(".tx-state{display:flex;flex-direction:column;align-items:center;flex-grow:1}.tx-state-icon.success{color:green}.tx-state-icon.failed{color:red}.tx-state-icon.warn{color:orange}.tx-state-msg{word-break:break-word;white-space:normal}\n")){constructor(){super(),this.bindBridge=new h(this,w),this.txType=!1,this.onlyAwaitHash=!1,this.opts={}}get bridge(){return w.bridge}get icons(){const[t='<i class="mdi mdi-check-all"></i>',e='<i class="mdi mdi-check"></i>',s='<i class="mdi mdi-close"></i>',i='<i class="mdi mdi-loading"></i>']=this.opts.icons??[];return{success:t,failed:s,wait:i,almostSuccess:e}}get hashOk(){return this.onlyAwaitHash&&this.tx.hash}get state(){let[t,e,s]=["","",""];const{state:i}=this.opts;switch(this.tx.status){case-1:[t,e,s]=[this.icons.wait,i?.wait||"Waiting for confirmation...","wait"];break;case 0:[t,e,s]=[this.icons.failed,this.tx.err?.message??"Something went wrong","failed"];break;case 1:[t,e,s]=[this.icons.success,i?.success||"Success","success"];break;case 2:[t,e]=[this.icons.wait,"Confirm the transaction."];break;case 4:[t,e,s]=[this.icons.almostSuccess,this.tx.err?.message||"Almost Success","warn"]}return this.hashOk&&([t,e,s]=[this.icons.success,i?.success||"Success","success"]),{icon:t,txt:e,css:s}}get txScanUri(){const{hash:t}=this.tx;return t?`${this.bridge.network.current.scan}/tx/${t}`:""}render(){return d`<div class="tx-state m-4"><div class="tx-state-icon my-3 text-3xl mx-auto ${this.state.css}">${f(this.tx.pending&&!this.hashOk,(()=>d`<slot name="pending"><i class="mdi mdi-loading"></i></slot>`),(()=>d`<span>${g(this.state.icon)}</span>`))}</div><div class="tx-state-msg my-4"><slot>${this.state.txt}</slot></div><div class="flex gap-4">${f(this.tx.hash,(()=>d`${f(this.tx.success||this.tx.almostSuccess,(()=>d`<slot name="view"><tx-view .tx="${this.tx}"></tx-view></slot>`),(()=>d`<tx-view .tx="${this.tx}"></tx-view>`))}`))}</div></div>`}};X([l({type:Object})],Y.prototype,"tx",2),X([l({type:Boolean})],Y.prototype,"txType",2),X([l({type:Boolean})],Y.prototype,"onlyAwaitHash",2),X([l({type:Object})],Y.prototype,"opts",2),Y=X([u("tx-state")],Y)}}}));
